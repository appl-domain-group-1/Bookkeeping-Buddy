{% extends 'base.html' %}

{% block content %}

<script>
    var minDate, maxDate;

// Custom filtering function which will search data in column four between two values
$.fn.dataTable.ext.search.push(
    function( settings, data, dataIndex ) {
        var min = minDate.val();
        var max = maxDate.val();
        var date = new Date( data[1] );

        if (
            ( min === null && max === null ) ||
            ( min === null && date <= max ) ||
            ( min <= date   && max === null ) ||
            ( min <= date   && date <= max )
        ) {
            return true;
        }
        return false;
    }
);

$(document).ready(function() {
    // Create date inputs
    minDate = new DateTime($('#min'), {
        format: 'MMMM Do YYYY'
    });
    maxDate = new DateTime($('#max'), {
        format: 'MMMM Do YYYY'
    });

    // DataTables initialisation
    var table = $('#myTable').DataTable();

    // Refilter the table
    $('#min, #max').on('change', function () {
        table.draw();
    });
});
    $(document).ready(function(){
    $("select").change(function(){
        $(this).find("option:selected").each(function(){
            var optionValue = $(this).attr("value");
            if(optionValue){
                $(".entry").not("." + optionValue).hide();
                $("." + optionValue).show();
            } else{
                $(".entry").hide();
            }
        });
    }).change();
});
    function get_reject_reason(id) {
        let reject_reason = prompt("Enter reason this entry should be rejected:");
        if (reject_reason != null || reject_reason !== ""){
            window.location.href='/journaling/reject_entry?entry_id=' + id + '&reject_reason=' + reject_reason;
        }
    }
    //$(document).ready(function(){
  //$("#myInput").on("keyup", function() {
   // var value = $(this).val().toLowerCase();
   // $("#myTable tr").filter(function() {
    //  $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
    //});
 // });
//});
</script>
<div >
        <select style=" font-size: x-large; font-weight: bold; height: 50px; color: white; background: transparent">
            <option style="color: black; font-size: large" value = "entry">Choose a Journal Entry</option>
            <option style="color: black; font-size: large" value="approved">Approved Entries</option>
            <option style="color: black; font-size: large" value="pending">Pending Entries</option>
            <option style="color: black; font-size: large" value="rejected">Rejected Entries</option>
        </select>
    </div>

<br>
<!--<input style="width: 100%" class="form-control" id="myInput" type="text" placeholder="Search by account number or account name">-->
<table border="0" cellspacing="5" cellpadding="5">
        <tbody><tr>
            <td style="color: white">Start date:</td>
            <td><input type="text" id="min" name="min"></td>
        </tr>
        <tr>
            <td style="color: white">End date:</td>
            <td><input type="text" id="max" name="max"></td>
        </tr>
    </tbody></table>
   <h2 style="color: white" class = "approved entry">Approved Entries</h2>
<div  class="table-responsive">
    <table class = "table table-sm approved entry" style="height:110px; width:100%; border-bottom: 1px solid #F89E19" id = "myTable">
        <thead>
            <tr>
                <th>Entry ID</th>
                <th>Date Submitted</th>
                <th>Submitted By</th>
                <th>Approved By</th>
                <th>Description</th>
                <th>Accounts Credited</th>
                <th>Accounts Debited</th>
                <th>Attachment</th>
            </tr>
        </thead>
        <tbody >
            {% for entry in approved_entries %}
                <tr id="entry_{{ entry['id_num'] }}">
                    <td>{{entry['id_num']}}</td>
                    <td>{{entry['date_submitted']}}</td>
                    <td>{{entry['user']}}</td>
                    <td>{{entry['approver']}}</td>
                    <td>{{entry['description']}}</td>
                    <td>
                        <table>
                            <thead>
                                <tr>
                                    <th>Account</th>
                                    <th>Value</th>
                                </tr>
                                    {% for credit in entry['credits'] %}
                                    <tr>
                                        <td><a href="{{ url_for('fin_accts.view_ledger', account_num=credit) }}">#{{ credit }}</a></td>
                                        <td class="show-comma">{{ entry['credits'][credit] }}</td>
                                    </tr>
                                {% endfor %}
                            </thead>
                        </table>
                    </td>
                    <td>
                        <table>
                            <thead>
                                <tr>
                                    <th>Account</th>
                                    <th>Value</th>
                                </tr>
                                    {% for debit in entry['debits'] %}
                                    <tr>
                                        <td><a href="{{ url_for('fin_accts.view_ledger', account_num=debit) }}">#{{ debit }}</a></td>
                                        <td class="show-comma">{{ entry['debits'][debit] }}</td>
                                    </tr>
                                {% endfor %}
                            </thead>
                        </table>
                    </td>
                    <td><a href="{{ url_for('journaling.get_attachment', entry_id=entry['id_num']) }}">{{entry['attachment_name']}}</a></td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
    <h2  class = "pending entry" style="color: white">Pending Entries</h2>
<div  class="table-responsive" >
    <table class = "table table-sm  pending entry" style="height:110px; width:100%; border-bottom: 1px solid #F89E19" id = "myTable">
        <thead>
            <tr>
                <th>Entry ID</th>
                <th>Date Submitted</th>
                <th>Submitted By</th>
                <th>Description</th>
                <th>Accounts Credited</th>
                <th>Accounts Debited</th>
                <th>Attachment</th>
                {% if g.user['role'] == 1 or g.user['role'] == 2 %}
                    <th>Entry Actions</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for entry in pending_entries %}
                <tr id="entry_{{ entry['id_num'] }}">
                    <td>{{entry['id_num']}}</td>
                    <td>{{entry['date_submitted']}}</td>
                    <td>{{entry['user']}}</td>
                    <td>{{entry['description']}}</td>
                    <td>
                        <table>
                            <thead>
                                <tr>
                                    <th>Account</th>
                                    <th>Value</th>
                                </tr>
                                    {% for credit in entry['credits'] %}
                                    <tr>
                                        <td><a href="{{ url_for('fin_accts.view_ledger', account_num=credit) }}">#{{ credit }}</a></td>
                                        <td class="show-comma">{{ entry['credits'][credit] }}</td>
                                    </tr>
                                {% endfor %}
                            </thead>
                        </table>
                    </td>
                    <td>
                        <table>
                            <thead>
                                <tr>
                                    <th>Account</th>
                                    <th>Value</th>
                                </tr>
                                    {% for debit in entry['debits'] %}
                                    <tr>
                                        <td><a href="{{ url_for('fin_accts.view_ledger', account_num=debit) }}">#{{ debit }}</a></td>
                                        <td class="show-comma">{{ entry['debits'][debit] }}</td>
                                    </tr>
                                {% endfor %}
                            </thead>
                        </table>
                    </td>
                    <td><a href="{{ url_for('journaling.get_attachment', entry_id=entry['id_num']) }}">{{entry['attachment_name']}}</a></td>
                    {% if g.user['role'] == 1 or g.user['role'] == 2 %}
                        <td>
                            <button onclick="window.location.href='{{ url_for('journaling.approve_entry', entry_id=entry['id_num']) }}'">Approve</button>
                            <button onclick="get_reject_reason({{entry['id_num']}})">Reject</button>
                        </td>
                    {% endif %}
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
    <h2  class = "rejected entry" style="color: white">Rejected Entries</h2>
<div  class="table-responsive">
    <table class = "table table-sm rejected entry" style="height:110px; width:100%; border-bottom: 1px solid #F89E19" id = "myTable">
        <thead>
            <tr>
                <th>Entry ID</th>
                <th>Date Submitted</th>
                <th>Submitted By</th>
                <th>Rejected By</th>
                <th>Rejection Reason</th>
                <th>Description</th>
                <th>Accounts Credited</th>
                <th>Accounts Debited</th>
                <th>Attachment</th>
            </tr>
        </thead>
        <tbody>
            {% for entry in rejected_entries %}
                <tr id="entry_{{ entry['id_num'] }}">
                    <td>{{entry['id_num']}}</td>
                    <td>{{entry['date_submitted']}}</td>
                    <td>{{entry['user']}}</td>
                    <td>{{entry['approver']}}</td>
                    <td>{{entry['reject_reason']}}</td>
                    <td>{{entry['description']}}</td>
                    <td>
                        <table>
                            <thead>
                                <tr>
                                    <th>Account</th>
                                    <th>Value</th>
                                </tr>
                                    {% for credit in entry['credits'] %}
                                    <tr>
                                        <td><a href="{{ url_for('fin_accts.view_ledger', account_num=credit) }}">#{{ credit }}</a></td>
                                        <td class="show-comma">{{ entry['credits'][credit] }}</td>
                                    </tr>
                                {% endfor %}
                            </thead>
                        </table>
                    </td>
                    <td>
                        <table>
                            <thead>
                                <tr>
                                    <th>Account</th>
                                    <th>Value</th>
                                </tr>
                                    {% for debit in entry['debits'] %}
                                    <tr>
                                        <td><a href="{{ url_for('fin_accts.view_ledger', account_num=debit) }}">#{{ debit }}</a></td>
                                        <td class="show-comma">{{ entry['debits'][debit] }}</td>
                                    </tr>
                                {% endfor %}
                            </thead>
                        </table>
                    </td>
                    <td><a href="{{ url_for('journaling.get_attachment', entry_id=entry['id_num']) }}">{{entry['attachment_name']}}</a></td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<button data-toggle="tooltip" data-placement="top" title="Create a new journal entry" type="button" style="display: block; border-color: #F89E19; margin: auto; padding: 10px; background-color: #185DFF; color: white; border-radius: 6px; width: 200px"  onclick="window.location.href='{{ url_for('journaling.add_entry')}}'">Create New Entry</button>

{% endblock %}